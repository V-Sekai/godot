#!/usr/bin/env python

# ruff: noqa - SCons build script with SCons-specific syntax
Import("env")
Import("env_modules")

env_mcp = env_modules.Clone()
# Exclude mcp_client.cpp for now (has compilation issues)
env_mcp.add_source_files(env.modules_sources, "mcp_server.cpp")
env_mcp.add_source_files(env.modules_sources, "script_server.cpp")
env_mcp.add_source_files(env.modules_sources, "mcp_runner.cpp")
env_mcp.add_source_files(env.modules_sources, "mcp_protocol.cpp")
env_mcp.add_source_files(env.modules_sources, "http_stream_transport.cpp")
env_mcp.add_source_files(env.modules_sources, "register_types.cpp")

if env["tests"]:
    env_mcp.Append(CPPDEFINES=["TESTS_ENABLED"])

    if env["disable_exceptions"]:
        env_mcp.Append(CPPDEFINES=["DOCTEST_CONFIG_NO_EXCEPTIONS_BUT_WITH_ALL_ASSERTS"])
